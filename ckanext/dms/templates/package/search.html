{% ckan_extends %}

{% set tags = h.get_facet_items_dict('tags', c.search_facets, limit=3) %}
{% set placeholder = _('E.g. environment') %}
{% set stats = h.get_site_statistics() %}

{% block subtitle %}{{ _(dataset_type.title()) }}{% endblock %}

{% block breadcrumb_content %}
  <li class="active">{{ h.nav_link(_(dataset_type.title() + 's'), named_route='%s.search' % dataset_type, highlight_actions = 'new index') }}</li>
{% endblock %}

{%- block content %}
    <div role="main">
        <div class="main hero navigation_section_background with-min-height">

            {#      section with piling documents #}
            <div class="container-fluid promoted-background">
                <div class="container">
                    <div class="row">
                        <p class="navigation_title">Home / </p>
                        <h1 class="navigation_subtitle">Datasets</h1>
                        {% if h.check_access('package_create') %}
                          <div class="navigation_add">
                            {{ h.snippet ('snippets/add_dataset.html', dataset_type=dataset_type) }}
                          </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>


{% block primary_content %}

  <section class="module">
    <div class="module-content container">
      {% block page_primary_action %}
      {% endblock %}

      {% block form %}
        {% set facets = {
          'fields': fields_grouped,
          'search': search_facets,
          'titles': facet_titles,
          'translated_fields': translated_fields,
          'remove_field': remove_field }
        %}
        {% set sorting = [
          (_('Relevance'), 'score desc, metadata_modified desc'),
          (_('Name Ascending'), 'title_string asc'),
          (_('Name Descending'), 'title_string desc'),
          (_('Last Modified'), 'metadata_modified desc'),
          (_('Popular'), 'views_recent desc') if g.tracking_enabled else (false, false) ]
        %}
        <div class="">
          {% snippet 'snippets/search_form.html', form_id='dataset-search-form', type=dataset_type, query=q, sorting=sorting, sorting_selected=sort_by_selected, count=page.item_count, placeholder=_('Search ' + dataset_type + 's') + '...', facets=facets, show_empty=request.params, error=query_error, fields=fields%}
        </div>
      {% endblock %}
      {% block package_search_results_list %}
        <div class="container-fluid">
            {{ h.snippet('snippets/package_list.html', packages=page.items) }}
        </div>



      {% endblock %}
    </div>

    {% block page_pagination %}
      {{ page.pager(q=q) }}
    {% endblock %}
  </section>

  {% block package_search_results_api %}
  {% endblock %}
{% endblock %}

    <div class="subscribe container-fluid">
        <div class="container section-separator">
            <div class="row">
                {% snippet 'home/snippets/subscribe_to_updates.html' %}
            </div>
        </div>
    </div>

</div>
{%  endblock %}


